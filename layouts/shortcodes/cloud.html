<div class="cloud"></div>

<style>
	.cloud {
		display: flex;
		position: absolute;
		margin: auto;
	}
</style>


<script type="importmap">
	{
		"imports": {
			"three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
			"loader": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/js/loaders/GLTFLoader.js",
			"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
		}
	}
</script>
<script src=></script>
<script src=""></script>
<script type="module">
import * as THREE from 'three';
import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
	
const width = window.innerWidth/2, height = window.innerHeight/2;

// init

const camera = new THREE.PerspectiveCamera( 70, width / height, 0.01, 1000 );
camera.position.z = 1

const scene = new THREE.Scene();
const cloud = document.querySelector('.cloud');

const geometry = new THREE.BoxGeometry( 1,1,1 );
const material = new THREE.MeshNormalMaterial();

const mesh = new THREE.Mesh( geometry, material );
scene.add( mesh );

const renderer = new THREE.WebGLRenderer( { antialias: true } );
renderer.setSize( width, height );

const controls = new PointerLockControls( camera, renderer.domElement );
controls.movementSpeed = 10;
controls.isLocked = false

const clock = new THREE.Clock();
const globalDir = new THREE.Vector3( 0, 0, 0 );

cloud.appendChild( renderer.domElement );

window.addEventListener( 'resize', onWindowResize );

function onWindowResize() {

	camera.aspect = width / height;
	camera.updateProjectionMatrix();

	renderer.setSize( width, height );
	//controls.handleResize();
}
// animation

let moveForward = false;
let moveBackward = false;
let moveLeft = false;
let moveRight = false;

const velocity = 0.05;

const euler = new THREE.Euler( 0, 0, 0, 'YXZ' );
const vector = new THREE.Vector3();

let mouseDown = false

function onMouseDown( event ) {
	mouseDown = true
}

function onMouseUp( event ) {
	mouseDown = false
}

function onMouseMove( event ) {
	if ( mouseDown === false ) return;

	const movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
	const movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

	euler.setFromQuaternion( camera.quaternion );

	euler.y -= movementX * 0.002;
	euler.x -= movementY * 0.002;

	euler.x = Math.max( - Math.PI / 2, Math.min(Math.PI / 2, euler.x ) );

	camera.quaternion.setFromEuler( euler );
}

const onKeyDown = function ( event ) {

	switch ( event.code ) {

		case 'ArrowUp':
		case 'KeyW':
			moveForward = true;
			break;

		case 'ArrowLeft':
		case 'KeyA':
			moveLeft = true;
			break;

		case 'ArrowDown':
		case 'KeyS':
			moveBackward = true;
			break;

		case 'ArrowRight':
		case 'KeyD':
			moveRight = true;
			break;

	}

};

const onKeyUp = function ( event ) {

	switch ( event.code ) {

		case 'ArrowUp':
		case 'KeyW':
			moveForward = false;
			break;

		case 'ArrowLeft':
		case 'KeyA':
			moveLeft = false;
			break;

		case 'ArrowDown':
		case 'KeyS':
			moveBackward = false;
			break;

		case 'ArrowRight':
		case 'KeyD':
			moveRight = false;
			break;

	}

};

function getDirection( v ) {
	return v.set( 0, 0, - 1 ).applyQuaternion( camera.quaternion );
}


window.addEventListener( "mousedown", onMouseDown, false );
window.addEventListener( "mouseup", onMouseUp, false );
window.addEventListener( "mousemove", onMouseMove, false );

window.addEventListener( 'keydown', onKeyDown );
window.addEventListener( 'keyup', onKeyUp );


const onMoveForward = function (distance) {
	vector.copy(controls.getDirection(vector));

	camera.position.addScaledVector(vector, distance);
}

const onMoveRight = function (distance) {
	vector.setFromMatrixColumn( camera.matrix, 0 );

		camera.position.addScaledVector( vector, distance );
}



function animate() {
	requestAnimationFrame( animate );

	
	if ( moveForward ) onMoveForward( velocity );
	if ( moveBackward ) onMoveForward( -velocity );

	if ( moveLeft ) onMoveRight( -velocity );
	if ( moveRight ) onMoveRight( velocity );

	renderer.render( scene, camera );

}
animate()
</script>